# truSDX USB Serial Device Rules - Prevent disconnections
# CH340 USB-to-Serial converter used by truSDX

# Disable autosuspend for CH340 serial converter (truSDX)
SUBSYSTEM=="usb", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", TEST=="power/control", ATTR{power/control}="on"
SUBSYSTEM=="usb", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", TEST=="power/autosuspend", ATTR{power/autosuspend}="-1"
SUBSYSTEM=="usb", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", TEST=="power/autosuspend_delay_ms", ATTR{power/autosuspend_delay_ms}="-1"

# Set permissions for dialout group
SUBSYSTEM=="tty", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", MODE="0666", GROUP="dialout"

# Force TTY child to stay on (prevent runtime PM on ttyUSB child)
SUBSYSTEM=="tty", KERNEL=="ttyUSB*", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", TEST=="power/control", ATTR{power/control}="on"

# Also force the usb-serial interface to stay on
SUBSYSTEM=="usb-serial", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", TEST=="power/control", ATTR{power/control}="on"

# Create a stable symlink for the device
SUBSYSTEM=="tty", ATTRS{idVendor}=="1a86", ATTRS{idProduct}=="7523", SYMLINK+="trusdx"
